<?php
session_start();
error_reporting(0);

$admin=$_GET['admin'];
$task=$_GET['task'];
$attdisp=$_GET['attdisp'];
?>
<link rel="shortcut icon" href="images/logo.gif">
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title> Faculty of Science, University of Ruhuna | Management Information System | [ F O S M I S ]</title>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<meta name="author" content="Iranga Muthumala, Sathiska Udayanga and Amal Ranganath" />
<meta name="Keywords" content="Faculty of Science, University of Ruhuna" />
<meta name="Description" content="MIS of faculty of Science University of Ruhuna" />

<script src="SpryAssets/SpryValidationTextField.js" type="text/javascript"></script>
<script src="SpryAssets/SpryValidationPassword.js" type="text/javascript"></script>
<script src="SpryAssets/SpryValidationTextarea.js" type="text/javascript"></script>
<link href="SpryAssets/SpryValidationTextField.css" rel="stylesheet" type="text/css" />
<link href="SpryAssets/SpryValidationPassword.css" rel="stylesheet" type="text/css" />
<link href="SpryAssets/SpryValidationTextarea.css" rel="stylesheet" type="text/css" />

<link href="css/fosmiscss.css" rel="stylesheet" type="text/css"/>
<link href="style/jquery-ui.css" rel="stylesheet" type="text/css"/>
<script src="style/jquery.min.js"></script>
<script src="style/jquery-ui.min.js"></script>
<script src="style/jquery.tooltip.js"></script>

<noscript><meta http-equiv="refresh" content="0; url=jsnotspt.php"></noscript>

<script type="text/javascript" src="Ajax/tasks.js"></script>



<!--///////////////////////////////////////////////////////////////////
////////////////////////////must cng pwd///////////////////////////////
///////////////////////////////////////////////////////////////////////
-->
<script>
function load(reason)
{
    alert("Periodically password change alert!\nPlease change your password.");
       window.location = "mpcng.php?rea_cng="+reason
 }
</script>
<!--///////////////////////////////////////////////////////////////////
////////////////////////////must cng pwd///////////////////////////////
///////////////////////////////////////////////////////////////////////
-->



<script language="JavaScript" type="text/JavaScript">
function smenu(ele){
document.getElementById(ele).style.visibility="visible"
}

function hmenu(ele){
document.getElementById(ele).style.visibility="hidden"
}
</script>








</head>
<body>
<?php


echo"<div id=a>";



include'connection/connection.php';
////////////////////// validate date from all registration on/off///////////////////////// 
include 'datevalidation.php';
//////////////////////////////////////////////////////////////////////////////////////////









///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////// remort login to site by remort user///////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////don't edit bellow code //////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////



if($_SESSION['remtgt']=="cntctorumis"){
echo"<div align='center'>";

//;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;//

if($_SESSION['role_id']==1){
	$_SESSION['role_id']=3;
	$_SESSION['role']="administrator";
	$_SESSION['admswich']="yes";
								}
								
								
$role=$_SESSION['role_id'];
echo"<table border=0 width=95%>";
echo"<tr class=newsbar><td align='center' colspan=2>";
echo'<marquee scrollamount="3" onmouseover="this.stop();" onmouseout="this.start();">Welcome To The Management Information System!';
include('news.php');
echo'</marquee>';
echo"</td></tr>";
echo"<tr><td align='center' width=90%>&nbsp;";

/////////////////////////////////////// mentor view /////////////////////////////////////////////////////////////	
if($role!="6"){
$abc=$_SESSION['user_id'];

$quegtmntid="select mentor_id from mentor where user_name='$abc'";
$qugtmntid=mysql_query($quegtmntid);
if(mysql_num_rows($qugtmntid)!=0){
  while($qgtmntid=mysql_fetch_array($qugtmntid)){
	$_SESSION['Smntid']=$qgtmntid['mentor_id'];
		
						}
	$mntid=$_SESSION['Smntid'];
	echo"<table border='0' width='95%'><tr>";
	echo"<td width='40'><img border='0' src='images/mentor.png' align='right'></td>";
	echo"<form method='POST' action='./forms/mentor.php?task=check'><td valign='middle'>";
	echo"<input type='submit' value='Check Your Mentoring Students'>";
	echo"</form></td></tr></table><br>";
}

}	
/////////////////////////////////////end mentor view////////////////////////////////////////////////////////////////	

echo"<td align=center>";
//////////////////////////////////// view Special notice //////////////////////////////////////////
		$quechknt="select Notice_ID,date_time from notice where Status<>0 order by Notice_ID";
		
		$quchknt=mysql_query($quechknt);
		if(mysql_num_rows($quchknt)!=0){
			$newnot=array();
			error_reporting(0);
			$today=date("Y-m-d");
			//echo$today;
			$nnot=0;
			while($qchknt=mysql_fetch_array($quchknt)){
				$Notice_ID=$qchknt['Notice_ID'];
				$date_time=$qchknt['date_time'];
					///////////////////////////// check notice new or old////////////////////////////////////
					$gtdatetm=explode("/",$date_time);
						$gtdate=$gtdatetm[0];
						$diff = abs(strtotime($today) - strtotime($gtdate));
			
							$years = floor($diff / (365*60*60*24));
							$months = floor(($diff - $years * 365*60*60*24) / (30*60*60*24));
							$days = floor(($diff - $years * 365*60*60*24 - $months*30*60*60*24)/ (60*60*24));

								if($years>=1){
									$months=($years*12)+$months;
										}
								if($months>=1){
									$days=($months*30)+$days;
										}
								
									if($days<=7){										
										$newnot[$nnot]="new";
											}
									else{
										$newnot[$nnot]="old";
											$queupaslod="update notice set Status='2' where Notice_ID='$Notice_ID'";
											mysql_query($queupaslod);
										}
														
						$nnot=$nnot+1;

									}// while loop close brec
					//////////////////////////////////////////////////////////////////////////////////////////
												

					if (in_array("new", $newnot)) {
						echo"<a href='./forms/form_53_a.php'><img src='./images/newnote.gif'><br><font size=2px><b>NOTICE</b></font></a>";
										}
					else{
						echo"<a href='./forms/form_53_a.php'><font size=2px ><b>SPECIAL<br> NOTICE </b></font></a>";
						}
	echo"</td></tr>";
						}
	
	///////////////////////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////// end view specails notice//////////////////////////////////////

	

	
//////////////////////////////////////// main menu//////////////////////////////////////////////////	
echo"<tr><td colspan=2 align=center>";

$quegetmmenu="select distinct(permi_group) from permission where role_id=".$_SESSION['role_id'];
$qugetmmenu=mysql_query($quegetmmenu);

echo"<table border=0><tr>";
while($qgetmmenu=mysql_fetch_array($qugetmmenu)){
	$prmimenu=$qgetmmenu['permi_group'];

echo"<td align='center' onMouseOver=smenu('tuto$prmimenu') onMouseOut=hmenu('tuto$prmimenu') width=100px><div>";
$pfile=$prmimenu.".gif";
echo "<img src=images/small/$pfile width=65px height=65px><br><font size=4>".ucfirst($prmimenu)."</font><br>";

		$query2="select id,description from permission where role_id=$role and permi_group='$prmimenu'";
		$prev=mysql_query($query2);
		echo"<table class='menu' id='tuto$prmimenu' align='left' border='0'  bgcolor='#f2cff8' width='280px'>";
		while($predata=mysql_fetch_array($prev)){
				echo '<tr><td valign="top" align="left"><font  size="4px"><b> &nbsp;*&nbsp;</b></font>';
					echo "<font  size='3px'><a href=?view=admin&admin=".$predata['id'].">";
					echo $predata['description']."</a></font>";
					echo '</td></tr>';

							}


echo"</table></div></td>";

						}

echo"</tr></table>";

////////////////////////////// end main menu/////////////////////////////////////////////////////////	
	echo"</td></tr></table>";
		////////////////////////// include page/////////////////////////////////////////////////////////////////////////////////
	if(isset($admin)){
			echo '<hr class="bar">';
			$quechkpermi="select id from permission where role_id=".$_SESSION['role_id']." and id=$admin";
			//echo$quechkpermi;
			$quchkpermi=mysql_query($quechkpermi);
				if(mysql_num_rows($quchkpermi)!=0){
						$getfile=$admin.".php";
						//echo$getfile;
						
						////////////////////////////// include permission pages//////////////////////////
						include "pages/$getfile";
						/////////////////////////////////////////////////////////////////////////////////
														}
				else{
					echo"<font color='red'>You have no permission to access this area!</font>";
					}
						}
		////////////////////////// end include page/////////////////////////////////////////////////////////////////////////////////



//;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;//


echo"</div>";
}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////don't edit above code ////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////// remort login to site by remort user///////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////












///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////// local login to site by local user/////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
else{





$true="true".$_SESSION['userhost'];
$faculty=$_SESSION['faculty'];
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////// attendence display //////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
if($attdisp=="displayatt"){

if((($_SESSION['login'])=="truefohssmis")&&(($_SESSION['userhost'])!="rumis")){
echo"<div align='center'>";
////////////////////////// include page/////////////////////////////////////////////////////////////////////////////////
	if(isset($admin)){
			echo '<h class="bar">';
		
			$quechkpermi="select id from permission where role_id=".$_SESSION['role_id']." and id=$admin";
			//echo$quechkpermi;
			$quchkpermi=mysql_query($quechkpermi);
				if(mysql_num_rows($quchkpermi)!=0){
						$getfile=$admin.".php";
						//echo$getfile;
						
						////////////////////////////// include permission pages//////////////////////////
						include "pages/$getfile";
						/////////////////////////////////////////////////////////////////////////////////
														}
				else{
					echo"<font color='red'>You have no permission to access this area!</font>";
					}
						}
	////////////////////////// end include page/////////////////////////////////////////////////////////////////////////////////
echo"</div>";
																			}
				}
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////end attendence display //////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////





////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////// general user page attendence not display ////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
else{

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////// header //////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////

echo"<table border=0 align='center' width='770px' style='background-image: url(picture/bgpic.jpg); background-repeat: no-repeat'>";
echo"<tr><td align='center'  width=15%><image src='picture/UoRlogo.png'>";

echo"<td align='left' height=110px width=65%><font size='6'>Faculty of Science </font><br><font size='5'>Management Information System <br>[ F O S M I S ]</font>";
echo"</td><td align='center' width=150px>&nbsp;";
if((($_SESSION['login'])=="truefohssmis")&&(($_SESSION['userhost'])!="rumis")){
if(($_SESSION['role'])=="student"){
$picname="../rumis/picture/user_pictures/student_std_pics/".$_SESSION['userhost']."_pic/".$_SESSION['ru_st_user_id'].".jpg";
	
		if(file_exists($picname)){
			echo"<img src='$picname' class='stretch' alt='' width=100px height=110px border=3>";
								}
		else{
			echo "<img src=../rumis/picture/user_pictures/student_std_pics/SCI_Fac_no_picture.png class='stretch' alt='' width=100px height=110px>";
								}
									}
else{
echo"&nbsp;";
		}

																		}

echo"</td></tr>";

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////end header //////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////



/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////// news bar ///////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////

echo"<tr class=newsbar><td align='center' colspan=3>";
echo'<marquee scrollamount="3" onmouseover="this.stop();" onmouseout="this.start();">Welcome To The Management Information System! ';
include('news.php');
echo'</marquee>';
echo"</td></tr>";

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////// end news bar ///////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////


